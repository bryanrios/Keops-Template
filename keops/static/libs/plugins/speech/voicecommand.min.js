SpeechRecognition=root.SpeechRecognition||root.webkitSpeechRecognition||root.mozSpeechRecognition||root.msSpeechRecognition||root.oSpeechRecognition;if(SpeechRecognition&&voice_command){$.root_.on("click",'[data-action="voiceCommand"]',function(e){if($.root_.hasClass("voice-command-active")){$.speechApp.stop()}else{$.speechApp.start();$("#speech-btn .popover").fadeIn(350)}e.preventDefault()});$(document).mouseup(function(e){if(!$("#speech-btn .popover").is(e.target)&&$("#speech-btn .popover").has(e.target).length===0){$("#speech-btn .popover").fadeOut(250)}});var modal=$('<div class="modal fade" id="voiceModal" tabindex="-1" role="dialog" aria-labelledby="remoteModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"></div></div></div>');modal.appendTo("body");if(debugState){root.console.log("This browser supports Voice Command")}$.speechApp=function(speech){speech.start=function(){smartSpeechRecognition.addCommands(commands);if(smartSpeechRecognition){smartSpeechRecognition.start();$.root_.addClass("voice-command-active");$.speechApp.playON();if(voice_localStorage){localStorage.setItem("sm-setautovoice","true")}}else{alert("speech plugin not loaded")}};speech.stop=function(){if(smartSpeechRecognition){smartSpeechRecognition.abort();$.root_.removeClass("voice-command-active");$.speechApp.playOFF();if(voice_localStorage){localStorage.setItem("sm-setautovoice","false")}if($("#speech-btn .popover").is(":visible")){$("#speech-btn .popover").fadeOut(250)}}};speech.playON=function(){var audioElement=document.createElement("audio");if(navigator.userAgent.match("Firefox/"))audioElement.setAttribute("src",$.sound_path+"voice_on"+".ogg");else audioElement.setAttribute("src",$.sound_path+"voice_on"+".mp3");audioElement.addEventListener("load",function(){audioElement.play()},true);if($.sound_on){audioElement.pause();audioElement.play()}};speech.playOFF=function(){var audioElement=document.createElement("audio");if(navigator.userAgent.match("Firefox/"))audioElement.setAttribute("src",$.sound_path+"voice_off"+".ogg");else audioElement.setAttribute("src",$.sound_path+"voice_off"+".mp3");$.get();audioElement.addEventListener("load",function(){audioElement.play()},true);if($.sound_on){audioElement.pause();audioElement.play()}};speech.playConfirmation=function(){var audioElement=document.createElement("audio");if(navigator.userAgent.match("Firefox/"))audioElement.setAttribute("src",$.sound_path+"voice_alert"+".ogg");else audioElement.setAttribute("src",$.sound_path+"voice_alert"+".mp3");$.get();audioElement.addEventListener("load",function(){audioElement.play()},true);if($.sound_on){audioElement.pause();audioElement.play()}};return speech}({})}else{$("#speech-btn").addClass("display-none")}(function(undefined){"use strict";if(!SpeechRecognition){root.smartSpeechRecognition=null;return undefined}var commandsList=[],recognition,callbacks={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},autoRestart,lastStartedAt=0,optionalParam=/\s*\((.*?)\)\s*/g,optionalRegex=/(\(\?:[^)]+\))\?/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#]/g,commandToRegExp=function(command){command=command.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^\\s]+)"}).replace(splatParam,"(.*?)").replace(optionalRegex,"\\s*$1?\\s*");return new RegExp("^"+command+"$","i")};var invokeCallbacks=function(callbacks){callbacks.forEach(function(callback){callback.callback.apply(callback.context)})};var initIfNeeded=function(){if(!isInitialized()){root.smartSpeechRecognition.init({},false)}};var isInitialized=function(){return recognition!==undefined};root.smartSpeechRecognition={init:function(commands,resetCommands){if(resetCommands===undefined){resetCommands=true}else{resetCommands=!!resetCommands}if(recognition&&recognition.abort){recognition.abort()}recognition=new SpeechRecognition;recognition.maxAlternatives=5;recognition.continuous=true;recognition.lang=voice_command_lang||"en-US";recognition.onstart=function(){invokeCallbacks(callbacks.start);if(debugState){root.console.log("%c âœ” SUCCESS: User allowed access the microphone service to start ",debugStyle_success);root.console.log("Language setting is set to: "+recognition.lang,debugStyle)}$.root_.removeClass("service-not-allowed");$.root_.addClass("service-allowed")};recognition.onerror=function(event){invokeCallbacks(callbacks.error);switch(event.error){case"network":invokeCallbacks(callbacks.errorNetwork);break;case"not-allowed":case"service-not-allowed":autoRestart=false;$.root_.removeClass("service-allowed");$.root_.addClass("service-not-allowed");if(debugState){root.console.log("%c WARNING: Microphone was not detected (either user denied access or it is not installed properly) ",debugStyle_warning)}if((new Date).getTime()-lastStartedAt<200){invokeCallbacks(callbacks.errorPermissionBlocked)}else{invokeCallbacks(callbacks.errorPermissionDenied)}break}};recognition.onend=function(){invokeCallbacks(callbacks.end);if(autoRestart){var timeSinceLastStart=(new Date).getTime()-lastStartedAt;if(timeSinceLastStart<1e3){setTimeout(root.smartSpeechRecognition.start,1e3-timeSinceLastStart)}else{root.smartSpeechRecognition.start()}}};recognition.onresult=function(event){invokeCallbacks(callbacks.result);var results=event.results[event.resultIndex],commandText;for(var i=0;i<results.length;i++){commandText=results[i].transcript.trim();if(debugState){root.console.log("Speech recognized: %c"+commandText,debugStyle)}for(var j=0,l=commandsList.length;j<l;j++){var result=commandsList[j].command.exec(commandText);if(result){var parameters=result.slice(1);if(debugState){root.console.log("command matched: %c"+commandsList[j].originalPhrase,debugStyle);if(parameters.length){root.console.log("with parameters",parameters)}}commandsList[j].callback.apply(this,parameters);invokeCallbacks(callbacks.resultMatch);var ignoreCallsFor=["sound on","mute","stop"];if(ignoreCallsFor.indexOf(commandsList[j].originalPhrase)<0){$.smallBox({title:commandsList[j].originalPhrase,content:"loading...",color:"#333",sound_file:"voice_alert",timeout:2e3});if($("#speech-btn .popover").is(":visible")){$("#speech-btn .popover").fadeOut(250)}}return true}}}if($(document.activeElement).prop("id")==="search-fld"){for(var i=0;i<results.length;i++){var s=results[i].transcript;$(document.activeElement).val(s);break}return true}invokeCallbacks(callbacks.resultNoMatch);$.smallBox({title:"Error: <strong>"+' " '+commandText+' " '+"</strong> no match found!",content:"Please speak clearly into the microphone",color:"#a90329",timeout:5e3,icon:"fa fa-microphone"});if($("#speech-btn .popover").is(":visible")){$("#speech-btn .popover").fadeOut(250)}return false};if(resetCommands){commandsList=[]}if(commands.length){this.addCommands(commands)}},start:function(options){initIfNeeded();options=options||{};if(options.autoRestart!==undefined){autoRestart=!!options.autoRestart}else{autoRestart=true}lastStartedAt=(new Date).getTime();recognition.start()},abort:function(){autoRestart=false;if(isInitialized){recognition.abort()}},debug:function(newState){if(arguments.length>0){debugState=!!newState}else{debugState=true}},setLanguage:function(language){initIfNeeded();recognition.lang=language},addCommands:function(commands){var cb,command;initIfNeeded();for(var phrase in commands){if(commands.hasOwnProperty(phrase)){cb=root[commands[phrase]]||commands[phrase];if(typeof cb!=="function"){continue}command=commandToRegExp(phrase);commandsList.push({command:command,callback:cb,originalPhrase:phrase})}}if(debugState){root.console.log("Commands successfully loaded: %c"+commandsList.length,debugStyle)}},removeCommands:function(commandsToRemove){if(commandsToRemove===undefined){commandsList=[];return}commandsToRemove=Array.isArray(commandsToRemove)?commandsToRemove:[commandsToRemove];commandsList=commandsList.filter(function(command){for(var i=0;i<commandsToRemove.length;i++){if(commandsToRemove[i]===command.originalPhrase){return false}}return true})},addCallback:function(type,callback,context){if(callbacks[type]===undefined){return}var cb=root[callback]||callback;if(typeof cb!=="function"){return}callbacks[type].push({callback:cb,context:context||this})}}}).call(this);var autoStart=function(){smartSpeechRecognition.addCommands(commands);if(smartSpeechRecognition){smartSpeechRecognition.start();$.root_.addClass("voice-command-active");if(voice_localStorage){localStorage.setItem("sm-setautovoice","true")}}else{alert("speech plugin not loaded")}};if(SpeechRecognition&&voice_command&&localStorage.getItem("sm-setautovoice")=="true"){autoStart()}if(SpeechRecognition&&voice_command_auto&&voice_command){autoStart()}